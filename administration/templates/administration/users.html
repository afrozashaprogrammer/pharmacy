{% extends 'administration/base.html' %}
{% block content %}
<main class="p-6 space-y-6">
    <!-- PAGE HEADER -->
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-semibold text-slate-800 dark:text-slate-100">{{ role|capfirst }}</h1>
        <button id="openUserOffcanvas" class="px-4 py-2 text-white bg-primary rounded-lg shadow hover:bg-primary/90">
            + New {{ role|capfirst }}
        </button>
    </div>

    <!-- USERS TABLE -->
    <div id="userTableParentContainer">
        {% include 'administration/htmx/user_table.html' %}
    </div>

    <!-- NEW USER OFFCANVAS -->
    <div id="userOffcanvas" class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-slate-800 shadow-xl transform translate-x-full transition-all duration-300 z-[9999]">
        <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
            <h2 class="text-xl font-semibold">New {{ role|capfirst }}</h2>
            <button id="closeUserOffcanvas" class="text-slate-500 hover:text-slate-800 dark:hover:text-slate-300">✕</button>
        </div>
        <form method="POST" action="{% url 'administration:new_user' %}">
            {% csrf_token %}
            <input type="hidden" name="list_role" value="{{ role }}">
            <div class="p-4 space-y-4">
                <div>
                    <label class="text-sm">Username</label>
                    <input type="text" name="username" placeholder="Enter username" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">First Name</label>
                    <input type="text" name="first_name" placeholder="Enter first name" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Last Name</label>
                    <input type="text" name="last_name" placeholder="Enter last name" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Phone Number</label>
                    <input type="text" name="phone_number" placeholder="Enter phone number" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Address</label>
                    <input type="text" name="address" placeholder="Enter address" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Gender</label>
                    <select name="gender" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm">Role</label>
                    <select name="role" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                        {% if role == 'doctor' %}
                            <option value="doctor">Doctor</option>
                        {% elif role == 'patient' %}
                            <option value="patient">Patient</option>
                        {% else %}
                            <option value="admin">Admin</option>
                            <option value="counter">Counter</option>
                            <option value="sample collection">Sample Collection</option>
                            <option value="lab">Lab</option>
                            <option value="delivery">Delivery</option>
                            <option value="cleaner">Cleaner</option>
                        {% endif %}
                    </select>
                </div>
                <button class="w-full py-2 bg-primary text-white rounded-lg hover:bg-primary/90">Create {{ role }}</button>
            </div>
        </form>
    </div>

    <!-- EDIT USER OFFCANVAS -->
    <div id="editUserOffcanvas" class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-slate-800 shadow-xl transform translate-x-full transition-all duration-300 z-[9999]">
        <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
            <h2 class="text-xl font-semibold">Edit {{ role|capfirst }}</h2>
            <button id="closeEditUserOffcanvas" class="text-slate-500 hover:text-slate-800 dark:hover:text-slate-300">✕</button>
        </div>
        <form method="POST" id="editUserForm">
            {% csrf_token %}
            <input type="hidden" name="list_role" value="{{ role }}">
            <div class="p-4 space-y-4">
                <div>
                    <label class="text-sm">Username</label>
                    <input type="text" id="edit_username" name="username" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">First Name</label>
                    <input type="text" id="edit_first_name" name="first_name" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Last Name</label>
                    <input type="text" id="edit_last_name" name="last_name" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Phone Number</label>
                    <input type="text" id="edit_phone_number" name="phone_number" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Address</label>
                    <input type="text" id="edit_address" name="address" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                </div>
                <div>
                    <label class="text-sm">Gender</label>
                    <select id="edit_gender" name="gender" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm">Role</label>
                    <select id="edit_role" name="role" class="mt-1 px-3 py-2 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                        {% if role == 'doctor' %}
                            <option value="doctor">Doctor</option>
                        {% elif role == 'patient' %}
                            <option value="patient">Patient</option>
                        {% else %}
                            <option value="admin">Admin</option>
                            <option value="counter">Counter</option>
                            <option value="sample collection">Sample Collection</option>
                            <option value="lab">Lab</option>
                            <option value="delivery">Delivery</option>
                            <option value="cleaner">Cleaner</option>
                        {% endif %}
                    </select>
                </div>
                <button class="w-full py-2 bg-primary text-white rounded-lg hover:bg-primary/90">Update {{ role }}</button>
            </div>
        </form>
    </div>

    <script>
    (function () {
        // NEW USER OFFCANVAS
        document.body.addEventListener("click", function (e) {
            const openBtn = e.target.closest("#openUserOffcanvas");
            const closeBtn = e.target.closest("#closeUserOffcanvas");
            const offcanvas = document.getElementById("userOffcanvas");
            if (!offcanvas) return;
            if (openBtn) offcanvas.classList.remove("translate-x-full");
            if (closeBtn) offcanvas.classList.add("translate-x-full");
        });

        // EDIT USER OFFCANVAS
        document.body.addEventListener("click", function (e) {
            const btn = e.target.closest(".edit-user-btn");
            const closeBtn = e.target.closest("#closeEditUserOffcanvas");
            const editOffcanvas = document.getElementById("editUserOffcanvas");
            const editForm = document.getElementById("editUserForm");
            if (!editOffcanvas || !editForm) return;

            if (btn) {
                document.getElementById("edit_username").value = btn.dataset.username || "";
                document.getElementById("edit_first_name").value = btn.dataset.firstName || "";
                document.getElementById("edit_last_name").value = btn.dataset.lastName || "";
                document.getElementById("edit_phone_number").value = btn.dataset.phone || "";
                document.getElementById("edit_address").value = btn.dataset.address || "";
                document.getElementById("edit_gender").value = btn.dataset.gender || "";
                document.getElementById("edit_role").value = btn.dataset.role || "";

                editForm.action = `/administration/edit-user/${btn.dataset.id}/`;
                editOffcanvas.classList.remove("translate-x-full");
            }

            if (closeBtn) editOffcanvas.classList.add("translate-x-full");
        });
    })();
    </script>
</main>
{% endblock %}

