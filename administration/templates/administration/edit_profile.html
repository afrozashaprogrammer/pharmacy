{% extends "administration/base.html" %}
{% block content %}

<div class="max-w-3xl mx-auto mt-12 p-8 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
  <h2 class="text-2xl font-bold mb-6 text-slate-900 dark:text-slate-100">Edit Profile</h2>

  <form method="POST" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}

    <!-- Django messages -->
    {% if messages %}
      <div class="space-y-2">
        {% for message in messages %}
          <div class="px-4 py-2 rounded-md text-sm
              {% if message.tags == 'success' %} bg-green-50 text-green-700 border border-green-200
              {% elif message.tags == 'error' %} bg-red-50 text-red-700 border border-red-200
              {% else %} bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 border border-slate-300 dark:border-slate-600
              {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- User Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">Username</label>
        <input type="text" name="username" value="{{ user.username }}" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100"/>
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">First Name</label>
        <input type="text" name="first_name" value="{{ user.first_name }}" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100"/>
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">Last Name</label>
        <input type="text" name="last_name" value="{{ user.last_name }}" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100"/>
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">Phone Number</label>
        <input type="text" name="phone_number" value="{{ profile.phone_number }}" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100"/>
      </div>
    </div>

    <!-- Address -->
    <div class="flex flex-col">
      <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">Address</label>
      <textarea name="address" rows="3" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100">{{ profile.address }}</textarea>
    </div>

    <!-- Gender -->
    <div class="flex flex-col w-1/2">
      <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">Gender</label>
      <select name="gender" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100">
        <option value="">Select</option>
        <option value="Male" {% if profile.gender == "Male" %}selected{% endif %}>Male</option>
        <option value="Female" {% if profile.gender == "Female" %}selected{% endif %}>Female</option>
        <option value="Other" {% if profile.gender == "Other" %}selected{% endif %}>Other</option>
      </select>
    </div>

    <!-- Profile Image -->
    <div class="flex items-center gap-4">
      <div class="flex-shrink-0">
        {% if profile.image %}
          <img id="profilePreview" src="{{ profile.image.url }}" class="w-24 h-24 rounded-full object-cover border dark:border-slate-600"/>
        {% else %}
          <div id="profilePreview" class="w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-slate-500">No Image</div>
        {% endif %}
      </div>
      <div class="flex-1">
        <label class="text-sm font-medium mb-1 text-slate-700 dark:text-slate-200">Change Profile Image</label>
        <input type="file" name="image" accept="image/*" onchange="previewImage(event)" class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-slate-100"/>
        <p class="text-xs text-slate-400 mt-1">Max size 2MB. JPG, PNG only.</p>
      </div>
    </div>

    <!-- Submit -->
    <div>
      <button type="submit" class="px-6 py-2 bg-primary text-white font-semibold rounded-lg shadow hover:bg-purple-600 transition-all">
        Update Profile
      </button>
    </div>

  </form>
</div>

<script>
function previewImage(event){
    const input = event.target;
    const preview = document.getElementById('profilePreview');
    const file = input.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(e){
            preview.src = e.target.result;
        }
        reader.readAsDataURL(file);
    }
}
</script>

{% endblock %}
